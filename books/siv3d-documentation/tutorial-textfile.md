---
title: "チュートリアル 24 | テキストファイル"
free: true
---

# 24. テキストファイル
この章では、テキストファイルの内容を読み込んだり、テキストファイルに文字を書き込んだりする方法を学びます。

## 24.1 テキストファイルから 1 行ずつ読み込む
テキストファイルからテキストを読み込むには `TextReader` クラスの機能を使います。`TextReader` のコンストラクタ引数に、読み込みたいテキストファイルのパスを渡します。このファイルパスは、実行ファイルがあるフォルダ（開発中は App フォルダ）を基準とする相対パスか、絶対パスを使用します。リリース用のアプリを作るときには、のちの章で説明する「リソース」パスの使用を推奨します。ファイルが存在しない場合など、オープンに失敗したかどうかは `if (not reader)` で調べられます。

オープン直後は、読み込み位置はファイルの先頭にセットされています。`.readLine()` に `String` 型の変数を参照で渡すと、読み込み位置を始点とし、次に見つかった改行またはファイル終端までの 1 行分を読み込んだ内容をその変数に格納し、読み込み位置をそこまで進めて `true` を返します。読み込み位置がすでにファイルの終端にあって、これ以上読み込めないときには `false` を返します。次のプログラムのように `while` ループと組み合わせると便利です。

ファイルはデストラクタでクローズされるので、明示的にクローズする必要はありません。

```cpp
# include <Siv3D.hpp>

void Main()
{
	// ファイルをオープンする
	TextReader reader{ U"example/txt/en.txt" };

	// オープンに失敗
	if (not reader)
	{
		// 例外を投げて終了
		throw Error{ U"Failed to open `en.txt`" };
	}

	// 行の内容を読み込む変数
	String line;

	// 行数の表示用のカウント
	size_t i = 0;

	// 終端に達するまで 1 行ずつ読み込む
	while (reader.readLine(line))
	{
		Print << U"{}: {}"_fmt(i++, line);
	}

	while (System::Update())
	{

	}

	// reader のデストラクタで自動的にファイルがクローズされる
}
```


## 24.2 ファイルをオープン・クローズするタイミングを制御する
`TextReader` のコンストラクタでファイルをオープンせずに、`.open()` でファイルをオープンすることもできます。オープンに成功した場合は `true`, 失敗した場合は `false` を返します。

また通常は `TextReader` のデストラクタが実行されるタイミングでファイルがクローズされますが、例えば内容を読み込んだあとにテキストファイルを削除したり、別の内容を書き込みたい場合には、ファイルがオープンされたままだと操作ができないため、すぐにクローズしたいというケースでは、`.close()` でファイルを明示的にクローズします。

```cpp
# include <Siv3D.hpp>

void Main()
{
	TextReader reader;

	// オープンに失敗
	if (not reader.open(U"example/txt/en.txt"))
	{
		throw Error{ U"Failed to open `en.txt`" };
	}

	// 行の内容を読み込む変数
	String line;

	// 行数の表示用のカウント
	size_t i = 0;

	// 1 行ずつ読み込む
	while (reader.readLine(line))
	{
		Print << U"{}: {}"_fmt(i++, line);
	}

	// ファイルを明示的にクローズ
	reader.close();

	while (System::Update())
	{

	}
}
```


## 24.3 ファイルにテキストを書き込む

```cpp

```


## 24.4　既存のテキストファイルに追加で書きこむ

```cpp

```


## 24.5 スコープによる制御

```cpp

```

JSON ファイルや INI ファイル、CSV ファイルなど、特別なテキストファイルを扱いたい場合は、次章の機能を使うのが便利です。
